"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var tslib_1 = require("tslib");
var chai_1 = require("chai");
var util_1 = require("./util");
describe('interval selections at runtime in unit views', function () {
    var type = 'interval';
    var hits = util_1.hits.interval;
    var embed = util_1.embedFn(browser);
    var testRender = util_1.testRenderFn(browser, type + "/unit");
    it('should add extents to the store', function () {
        for (var i = 0; i < hits.drag.length; i++) {
            embed(util_1.spec('unit', i, { type: type }));
            var store = browser.execute(util_1.brush('drag', i)).value;
            chai_1.assert.lengthOf(store, 1);
            chai_1.assert.lengthOf(store[0].intervals, 2);
            chai_1.assert.equal(store[0].intervals[0].encoding, 'x');
            chai_1.assert.equal(store[0].intervals[0].field, 'a');
            chai_1.assert.equal(store[0].intervals[1].encoding, 'y');
            chai_1.assert.equal(store[0].intervals[1].field, 'b');
            chai_1.assert.lengthOf(store[0].intervals[0].extent, 2);
            chai_1.assert.lengthOf(store[0].intervals[1].extent, 2);
            testRender("drag_" + i);
        }
    });
    it('should respect projections', function () {
        embed(util_1.spec('unit', 0, { type: type, encodings: ['x'] }));
        for (var i = 0; i < hits.drag.length; i++) {
            var store = browser.execute(util_1.brush('drag', i)).value;
            chai_1.assert.lengthOf(store, 1);
            chai_1.assert.lengthOf(store[0].intervals, 1);
            chai_1.assert.equal(store[0].intervals[0].encoding, 'x');
            chai_1.assert.equal(store[0].intervals[0].field, 'a');
            chai_1.assert.lengthOf(store[0].intervals[0].extent, 2);
            testRender("x_" + i);
        }
        embed(util_1.spec('unit', 1, { type: type, encodings: ['y'] }));
        for (var i = 0; i < hits.drag.length; i++) {
            var store = browser.execute(util_1.brush('drag', i)).value;
            chai_1.assert.lengthOf(store, 1);
            chai_1.assert.lengthOf(store[0].intervals, 1);
            chai_1.assert.equal(store[0].intervals[0].encoding, 'y');
            chai_1.assert.equal(store[0].intervals[0].field, 'b');
            chai_1.assert.lengthOf(store[0].intervals[0].extent, 2);
            testRender("y_" + i);
        }
    });
    it('should clear out stored extents', function () {
        for (var i = 0; i < hits.drag_clear.length; i++) {
            embed(util_1.spec('unit', i, { type: type }));
            var store = browser.execute(util_1.brush('drag', i)).value;
            chai_1.assert.lengthOf(store, 1);
            store = browser.execute(util_1.brush('drag_clear', i)).value;
            chai_1.assert.lengthOf(store, 0);
            testRender("clear_" + i);
        }
    });
    it('should brush over binned domains', function () {
        embed(util_1.spec('unit', 1, { type: type, encodings: ['y'] }, {
            x: { aggregate: 'count', field: '*', type: 'quantitative' },
            y: { bin: true },
            color: { value: 'steelblue', field: null, type: null }
        }));
        for (var i = 0; i < hits.bins.length; i++) {
            var store_1 = browser.execute(util_1.brush('bins', i)).value;
            chai_1.assert.lengthOf(store_1, 1);
            chai_1.assert.lengthOf(store_1[0].intervals, 1);
            // length == 2 indicates a quantitative scale was inverted.
            chai_1.assert.lengthOf(store_1[0].intervals[0].extent, 2);
            testRender("bins_" + i);
        }
        var store = browser.execute(util_1.brush('bins_clear', 0)).value;
        chai_1.assert.lengthOf(store, 0);
    });
    it('should brush over ordinal/nominal domains', function () {
        var xextents = [[1, 2, 3, 4], [5, 6, 7, 8]];
        var yextents = [[48, 49, 52, 53, 54, 55, 66, 67, 68, 76, 81, 87, 91],
            [16, 17, 19, 23, 24, 27, 28, 35, 39, 43, 48]];
        for (var i = 0; i < hits.drag.length; i++) {
            embed(util_1.spec('unit', i, { type: type }, { x: { type: 'ordinal' }, y: { type: 'nominal' } }));
            var store_2 = browser.execute(util_1.brush('drag', i)).value;
            chai_1.assert.lengthOf(store_2, 1);
            chai_1.assert.lengthOf(store_2[0].intervals, 2);
            chai_1.assert.sameMembers(store_2[0].intervals[0].extent, xextents[i]);
            chai_1.assert.sameMembers(store_2[0].intervals[1].extent, yextents[i]);
            testRender("ord_" + i);
        }
        var store = browser.execute(util_1.brush('drag_clear', 0)).value;
        chai_1.assert.lengthOf(store, 0);
    });
    it('should brush over temporal domains', function () {
        var values = util_1.tuples.map(function (d) { return (tslib_1.__assign({}, d, { a: new Date(2017, d.a) })); });
        var toNumber = '[0].intervals[0].extent.map((d) => +d)';
        embed(util_1.spec('unit', 0, { type: type, encodings: ['x'] }, { values: values, x: { type: 'temporal' } }));
        var extents = [[1485969714000, 1493634384000], [1496346498000, 1504247004000]];
        for (var i = 0; i < hits.drag.length; i++) {
            var store = browser.execute(util_1.brush('drag', i) + toNumber).value;
            chai_1.assert.sameMembers(store, extents[i]);
            testRender("temporal_" + i);
        }
        var cleared = browser.execute(util_1.brush('drag_clear', 0)).value;
        chai_1.assert.lengthOf(cleared, 0);
        embed(util_1.spec('unit', 1, { type: type, encodings: ['x'] }, { values: values, x: { type: 'temporal', timeUnit: 'day' } }));
        extents = [[1136188800000, 1136275200000, 1136361600000], [1136448000000, 1136534400000]];
        for (var i = 0; i < hits.drag.length; i++) {
            var store = browser.execute(util_1.brush('drag', i) + toNumber).value;
            chai_1.assert.sameMembers(store, extents[i]);
            testRender("dayTimeUnit_" + i);
        }
        cleared = browser.execute(util_1.brush('drag_clear', 0)).value;
        chai_1.assert.lengthOf(cleared, 0);
    });
    it('should brush over log/pow scales', function () {
        for (var i = 0; i < hits.drag.length; i++) {
            embed(util_1.spec('unit', i, { type: type }, {
                x: { scale: { type: 'pow', exponent: 1.5 } },
                y: { scale: { type: 'log' } }
            }));
            var store = browser.execute(util_1.brush('drag', i)).value;
            chai_1.assert.lengthOf(store, 1);
            chai_1.assert.lengthOf(store[0].intervals, 2);
            chai_1.assert.lengthOf(store[0].intervals[0].extent, 2);
            chai_1.assert.lengthOf(store[0].intervals[1].extent, 2);
            testRender("logpow_" + i);
        }
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL2Frc2hhdHNocml2YXN0YXZhL3Rlc3QvdmVnYS1saXRlL3Rlc3QtcnVudGltZS9pbnRlcnZhbC50ZXN0LnRzIiwic291cmNlcyI6WyIvVXNlcnMvYWtzaGF0c2hyaXZhc3RhdmEvdGVzdC92ZWdhLWxpdGUvdGVzdC1ydW50aW1lL2ludGVydmFsLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsNkJBQTRCO0FBQzVCLCtCQUFzRjtBQUV0RixRQUFRLENBQUMsOENBQThDLEVBQUU7SUFDdkQsSUFBTSxJQUFJLEdBQUcsVUFBVSxDQUFDO0lBQ3hCLElBQU0sSUFBSSxHQUFHLFdBQVUsQ0FBQyxRQUFRLENBQUM7SUFDakMsSUFBTSxLQUFLLEdBQUcsY0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQy9CLElBQU0sVUFBVSxHQUFHLG1CQUFZLENBQUMsT0FBTyxFQUFLLElBQUksVUFBTyxDQUFDLENBQUM7SUFFekQsRUFBRSxDQUFDLGlDQUFpQyxFQUFFO1FBQ3BDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUMxQyxLQUFLLENBQUMsV0FBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBQyxJQUFJLE1BQUEsRUFBQyxDQUFDLENBQUMsQ0FBQztZQUMvQixJQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLFlBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7WUFDdEQsYUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDMUIsYUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ3ZDLGFBQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxD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Q0FBQztZQUNqRCxVQUFVLENBQUMsVUFBUSxDQUFHLENBQUMsQ0FBQztRQUMxQixDQUFDO1FBRUQsSUFBTSxLQUFLLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxZQUFLLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1FBQzVELGFBQU0sQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzVCLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLDJDQUEyQyxFQUFFO1FBQzlDLElBQU0sUUFBUSxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUMsSUFBTSxRQUFRLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQztZQUNwRSxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRWhELEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUMxQyxLQUFLLENBQUMsV0FBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBQyxJQUFJLE1BQUEsRUFBQyxFQUMxQixFQUFDLENBQUMsRUFBRSxFQUFDLElBQUksRUFBRSxTQUFTLEVBQUMsRUFBRSxDQUFDLEVBQUUsRUFB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QUFDO2dCQUN4QyxDQUFDLEVBQUUsRUFBQyxLQUFLLEVBQUUsRUFBQyxJQUFJLEVBQUUsS0FBSyxFQUFDLEVBQUM7YUFDMUIsQ0FBQyxDQUFDLENBQUM7WUFDSixJQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLFlBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7WUFDdEQsYUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDMUIsYUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ3ZDLGFBQU0sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDakQsYUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNqRCxVQUFVLENBQUMsWUFBVSxDQUFHLENBQUMsQ0FBQztRQUM1QixDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7YXNzZXJ0fSBmcm9tICdjaGFpJztcbmltcG9ydCB7YnJ1c2gsIGVtYmVkRm4sIGhpdHMgYXMgaGl0c01hc3Rlciwgc3BlYywgdGVzdFJlbmRlckZuLCB0dXBsZXN9IGZyb20gJy4vdXRpbCc7XG5cbmRlc2NyaWJlKCdpbnRlcnZhbCBzZWxlY3Rpb25zIGF0IHJ1bnRpbWUgaW4gdW5pdCB2aWV3cycsIGZ1bmN0aW9uKCkge1xuICBjb25zdCB0eXBlID0gJ2ludGVydmFsJztcbiAgY29uc3QgaGl0cyA9IGhpdHNNYXN0ZXIuaW50ZXJ2YWw7XG4gIGNvbnN0IGVtYmVkID0gZW1iZWRGbihicm93c2VyKTtcbiAgY29uc3QgdGVzdFJlbmRlciA9IHRlc3RSZW5kZXJGbihicm93c2VyLCBgJHt0eXBlfS91bml0YCk7XG5cbiAgaXQoJ3Nob3VsZCBhZGQgZXh0ZW50cyB0byB0aGUgc3RvcmUnLCBmdW5jdGlvbigpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGhpdHMuZHJhZy5sZW5ndGg7IGkrKykge1xuICAgICAgZW1iZWQoc3BlYygndW5pdCcsIGksIHt0eXBlfSkpO1xuICAgICAgY29uc3Qgc3RvcmUgPSBicm93c2VyLmV4ZWN1dGUoYnJ1c2goJ2RyYWcnLCBpKSkudmFsdWU7XG4gICAgICBhc3NlcnQubGVuZ3RoT2Yoc3RvcmUsIDEpO1xuICAgICAgYXNzZXJ0Lmxlbmd0aE9mKHN0b3JlWzBdLmludGVydmFscywgMik7XG4gICAgICBhc3NlcnQuZXF1YWwoc3RvcmVbMF0uaW50ZXJ2YWxzWzBdLmVuY29kaW5nLCAneCcpO1xuICAgICAgYXNzZXJ0LmVxdWFsKHN0b3JlWzBdLmludGVydmFsc1swXS5maWVsZCwgJ2EnKTtcbiAgICAgIGFzc2VydC5lcXVhbChzdG9yZVswXS5pbnRlcnZhbHNbMV0uZW5jb2RpbmcsICd5Jyk7XG4gICAgICBhc3NlcnQuZXF1YWwoc3RvcmVbMF0uaW50ZXJ2YWxzWzFdLmZpZWxkLCAnYicpO1xuICAgICAgYXNzZXJ0Lmxlbmd0aE9mKHN0b3JlWzBdLmludGVydmFsc1swXS5leHRlbnQsIDIpO1xuICAgICAgYXNzZXJ0Lmxlbmd0aE9mKHN0b3JlWzBdLmludGVydmFsc1sxXS5leHRlbnQsIDIpO1xuICAgICAgdGVzdFJlbmRlcihgZHJhZ18ke2l9YCk7XG4gICAgfVxuICB9KTtcblxuICBpdCgnc2hvdWxkIHJlc3BlY3QgcHJvamVjdGlvbnMnLCBmdW5jdGlvbigpIHtcbiAgICBlbWJlZChzcGVjKCd1bml0JywgMCwge3R5cGUsIGVuY29kaW5nczogWyd4J119KSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBoaXRzLmRyYWcubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHN0b3JlID0gYnJvd3Nlci5leGVjdXRlKGJydXNoKCdkcmFnJywgaSkpLnZhbHVlO1xuICAgICAgYXNzZXJ0Lmxlbmd0aE9mKHN0b3JlLCAxKTtcbiAgICAgIGFzc2VydC5sZW5ndGhPZihzdG9yZVswXS5pbnRlcnZhbHMsIDEpO1xuICAgICAgYXNzZXJ0LmVxdWFsKHN0b3JlWzBdLmludGVydmFsc1swXS5lbmNvZGluZywgJ3gnKTtcbiAgICAgIGFzc2VydC5lcXVhbChzdG9yZVswXS5pbnRlcnZhbHNbMF0uZmllbGQsICdhJyk7XG4gICAgICBhc3NlcnQubGVuZ3RoT2Yoc3RvcmVbMF0uaW50ZXJ2YWxzWzBdLmV4dGVudCwgMik7XG4gICAgICB0ZXN0UmVuZGVyKGB4XyR7aX1gKTtcbiAgICB9XG5cbiAgICBlbWJlZChzcGVjKCd1bml0JywgMSwge3R5cGUsIGVuY29kaW5nczogWyd5J119KSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBoaXRzLmRyYWcubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHN0b3JlID0gYnJvd3Nlci5leGVjdXRlKGJydXNoKCdkcmFnJywgaSkpLnZhbHVlO1xuICAgICAgYXNzZXJ0Lmxlbmd0aE9mKHN0b3JlLCAxKTtcbiAgICAgIGFzc2VydC5sZW5ndGhPZihzdG9yZVswXS5pbnRlcnZhbHMsIDEpO1xuICAgICAgYXNzZXJ0LmVxdWFsKHN0b3JlWzBdLmludGVydmFsc1swXS5lbmNvZGluZywgJ3knKTtcbiAgICAgIGFzc2VydC5lcXVhbChzdG9yZVswXS5pbnRlcnZhbHNbMF0uZmllbGQsICdiJyk7XG4gICAgICBhc3NlcnQubGVuZ3RoT2Yoc3RvcmVbMF0uaW50ZXJ2YWxzWzBdLmV4dGVudCwgMik7XG4gICAgICB0ZXN0UmVuZGVyKGB5XyR7aX1gKTtcbiAgICB9XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgY2xlYXIgb3V0IHN0b3JlZCBleHRlbnRzJywgZnVuY3Rpb24oKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBoaXRzLmRyYWdfY2xlYXIubGVuZ3RoOyBpKyspIHtcbiAgICAgIGVtYmVkKHNwZWMoJ3VuaXQnLCBpLCB7dHlwZX0pKTtcbiAgICAgIGxldCBzdG9yZSA9IGJyb3dzZXIuZXhlY3V0ZShicnVzaCgnZHJhZycsIGkpKS52YWx1ZTtcbiAgICAgIGFzc2VydC5sZW5ndGhPZihzdG9yZSwgMSk7XG5cbiAgICAgIHN0b3JlID0gYnJvd3Nlci5leGVjdXRlKGJydXNoKCdkcmFnX2NsZWFyJywgaSkpLnZhbHVlO1xuICAgICAgYXNzZXJ0Lmxlbmd0aE9mKHN0b3JlLCAwKTtcbiAgICAgIHRlc3RSZW5kZXIoYGNsZWFyXyR7aX1gKTtcbiAgICB9XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgYnJ1c2ggb3ZlciBiaW5uZWQgZG9tYWlucycsIGZ1bmN0aW9uKCkge1xuICAgIGVtYmVkKHNwZWMoJ3VuaXQnLCAxLCB7dHlwZSwgZW5jb2RpbmdzOiBbJ3knXX0sIHtcbiAgICAgIHg6IHthZ2dyZWdhdGU6ICdjb3VudCcsIGZpZWxkOiAnKicsIHR5cGU6ICdxdWFudGl0YXRpdmUnfSxcbiAgICAgIHk6IHtiaW46IHRydWV9LFxuICAgICAgY29sb3I6IHt2YWx1ZTogJ3N0ZWVsYmx1ZScsIGZpZWxkOiBudWxsLCB0eXBlOiBudWxsfVxuICAgIH0pKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGhpdHMuYmlucy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3Qgc3RvcmUgPSBicm93c2VyLmV4ZWN1dGUoYnJ1c2goJ2JpbnMnLCBpKSkudmFsdWU7XG4gICAgICBhc3NlcnQubGVuZ3RoT2Yoc3RvcmUsIDEpO1xuICAgICAgYXNzZXJ0Lmxlbmd0aE9mKHN0b3JlWzBdLmludGVydmFscywgMSk7XG4gICAgICAvLyBsZW5ndGggPT0gMiBpbmRpY2F0ZXMgYSBxdWFudGl0YXRpdmUgc2NhbGUgd2FzIGludmVydGVkLlxuICAgICAgYXNzZXJ0Lmxlbmd0aE9mKHN0b3JlWzBdLmludGVydmFsc1swXS5leHRlbnQsIDIpO1xuICAgICAgdGVzdFJlbmRlcihgYmluc18ke2l9YCk7XG4gICAgfVxuXG4gICAgY29uc3Qgc3RvcmUgPSBicm93c2VyLmV4ZWN1dGUoYnJ1c2goJ2JpbnNfY2xlYXInLCAwKSkudmFsdWU7XG4gICAgYXNzZXJ0Lmxlbmd0aE9mKHN0b3JlLCAwKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCBicnVzaCBvdmVyIG9yZGluYWwvbm9taW5hbCBkb21haW5zJywgZnVuY3Rpb24oKSB7XG4gICAgY29uc3QgeGV4dGVudHMgPSBbWzEsIDIsIDMsIDRdLCBbNSwgNiwgNywgOF1dO1xuICAgIGNvbnN0IHlleHRlbnRzID0gW1s0OCwgNDksIDUyLCA1MywgNTQsIDU1LCA2NiwgNjcsIDY4LCA3NiwgODEsIDg3LCA5MV0sXG4gICAgICBbMTYsIDE3LCAxOSwgMjMsIDI0LCAyNywgMjgsIDM1LCAzOSwgNDMsIDQ4XV07XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGhpdHMuZHJhZy5sZW5ndGg7IGkrKykge1xuICAgICAgZW1iZWQoc3BlYygndW5pdCcsIGksIHt0eXBlfSxcbiAgICAgICAge3g6IHt0eXBlOiAnb3JkaW5hbCd9LCB5OiB7dHlwZTogJ25vbWluYWwnfX0pKTtcbiAgICAgIGNvbnN0IHN0b3JlID0gYnJvd3Nlci5leGVjdXRlKGJydXNoKCdkcmFnJywgaSkpLnZhbHVlO1xuICAgICAgYXNzZXJ0Lmxlbmd0aE9mKHN0b3JlLCAxKTtcbiAgICAgIGFzc2VydC5sZW5ndGhPZihzdG9yZVswXS5pbnRlcnZhbHMsIDIpO1xuICAgICAgYXNzZXJ0LnNhbWVNZW1iZXJzKHN0b3JlWzBdLmludGVydmFsc1swXS5leHRlbnQsIHhleHRlbnRzW2ldKTtcbiAgICAgIGFzc2VydC5zYW1lTWVtYmVycyhzdG9yZVswXS5pbnRlcnZhbHNbMV0uZXh0ZW50LCB5ZXh0ZW50c1tpXSk7XG4gICAgICB0ZXN0UmVuZGVyKGBvcmRfJHtpfWApO1xuICAgIH1cblxuICAgIGNvbnN0IHN0b3JlID0gYnJvd3Nlci5leGVjdXRlKGJydXNoKCdkcmFnX2NsZWFyJywgMCkpLnZhbHVlO1xuICAgIGFzc2VydC5sZW5ndGhPZihzdG9yZSwgMCk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgYnJ1c2ggb3ZlciB0ZW1wb3JhbCBkb21haW5zJywgZnVuY3Rpb24oKSB7XG4gICAgY29uc3QgdmFsdWVzID0gdHVwbGVzLm1hcCgoZCkgPT4gKHsuLi5kLCBhOiBuZXcgRGF0ZSgyMDE3LCBkLmEpfSkpO1xuICAgIGNvbnN0IHRvTnVtYmVyID0gJ1swXS5pbnRlcnZhbHNbMF0uZXh0ZW50Lm1hcCgoZCkgPT4gK2QpJztcblxuICAgIGVtYmVkKHNwZWMoJ3VuaXQnLCAwLCB7dHlwZSwgZW5jb2RpbmdzOiBbJ3gnXX0sIHt2YWx1ZXMsIHg6IHt0eXBlOiAndGVtcG9yYWwnfX0pKTtcbiAgICBsZXQgZXh0ZW50cyA9IFtbMTQ4NTk2OTcxNDAwMCwgMTQ5MzYzNDM4NDAwMF0sIFsxNDk2MzQ2NDk4MDAwLCAxNTA0MjQ3MDA0MDAwXV07XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBoaXRzLmRyYWcubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHN0b3JlID0gYnJvd3Nlci5leGVjdXRlKGJydXNoKCdkcmFnJywgaSkgKyB0b051bWJlcikudmFsdWU7XG4gICAgICBhc3NlcnQuc2FtZU1lbWJlcnMoc3RvcmUsIGV4dGVudHNbaV0pO1xuICAgICAgdGVzdFJlbmRlcihgdGVtcG9yYWxfJHtpfWApO1xuICAgIH1cblxuICAgIGxldCBjbGVhcmVkID0gYnJvd3Nlci5leGVjdXRlKGJydXNoKCdkcmFnX2NsZWFyJywgMCkpLnZhbHVlO1xuICAgIGFzc2VydC5sZW5ndGhPZihjbGVhcmVkLCAwKTtcblxuICAgIGVtYmVkKHNwZWMoJ3VuaXQnLCAxLCB7dHlwZSwgZW5jb2RpbmdzOiBbJ3gnXX0sIHt2YWx1ZXMsIHg6IHt0eXBlOiAndGVtcG9yYWwnLCB0aW1lVW5pdDogJ2RheSd9fSkpO1xuXG4gICAgZXh0ZW50cyA9IFtbMTEzNjE4ODgwMDAwMCwgMTEzNjI3NTIwMDAwMCwgMTEzNjM2MTYwMDAwMF0sIFsxMTM2NDQ4MDAwMDAwLCAxMTM2NTM0NDAwMDAwXV07XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBoaXRzLmRyYWcubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHN0b3JlID0gYnJvd3Nlci5leGVjdXRlKGJydXNoKCdkcmFnJywgaSkgKyB0b051bWJlcikudmFsdWU7XG4gICAgICBhc3NlcnQuc2FtZU1lbWJlcnMoc3RvcmUsIGV4dGVudHNbaV0pO1xuICAgICAgdGVzdFJlbmRlcihgZGF5VGltZVVuaXRfJHtpfWApO1xuICAgIH1cblxuICAgIGNsZWFyZWQgPSBicm93c2VyLmV4ZWN1dGUoYnJ1c2goJ2RyYWdfY2xlYXInLCAwKSkudmFsdWU7XG4gICAgYXNzZXJ0Lmxlbmd0aE9mKGNsZWFyZWQsIDApO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGJydXNoIG92ZXIgbG9nL3BvdyBzY2FsZXMnLCBmdW5jdGlvbigpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGhpdHMuZHJhZy5sZW5ndGg7IGkrKykge1xuICAgICAgZW1iZWQoc3BlYygndW5pdCcsIGksIHt0eXBlfSwge1xuICAgICAgICB4OiB7c2NhbGU6IHt0eXBlOiAncG93JywgZXhwb25lbnQ6IDEuNX19LFxuICAgICAgICB5OiB7c2NhbGU6IHt0eXBlOiAnbG9nJ319XG4gICAgICB9KSk7XG4gICAgICBjb25zdCBzdG9yZSA9IGJyb3dzZXIuZXhlY3V0ZShicnVzaCgnZHJhZycsIGkpKS52YWx1ZTtcbiAgICAgIGFzc2VydC5sZW5ndGhPZihzdG9yZSwgMSk7XG4gICAgICBhc3NlcnQubGVuZ3RoT2Yoc3RvcmVbMF0uaW50ZXJ2YWxzLCAyKTtcbiAgICAgIGFzc2VydC5sZW5ndGhPZihzdG9yZVswXS5pbnRlcnZhbHNbMF0uZXh0ZW50LCAyKTtcbiAgICAgIGFzc2VydC5sZW5ndGhPZihzdG9yZVswXS5pbnRlcnZhbHNbMV0uZXh0ZW50LCAyKTtcbiAgICAgIHRlc3RSZW5kZXIoYGxvZ3Bvd18ke2l9YCk7XG4gICAgfVxuICB9KTtcbn0pO1xuIl19